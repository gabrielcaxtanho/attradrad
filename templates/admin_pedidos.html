<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Pedidos - Radiante Admin</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- MENU SUPERIOR -->
<header class="top-bar">
    <div class="menu2header">
        <div class="logo">
            <img src="{{ url_for('static', filename='lotus.png') }}"
                 alt="Logo"
                 class="logo-icon"
                 style="border-radius: 10px; width: 100px; height: auto;">
        </div>

        <div class="menu3header">
            <div class="search-box">
                <input type="text" placeholder="O que estÃ¡ buscando hoje?">
                <button><i class="fas fa-search"></i></button>
            </div>
        </div>
    </div>

    <div class="menu-icons">
        <a href="/"><i class="fa-solid fa-house"></i> InÃ­cio</a>
        <a href="ajuda"><i class="fas fa-question-circle"></i> Ajuda</a>
        <a href="carrinho"><i class="fas fa-shopping-bag"></i> Carrinho</a>
    </div>
</header>

<!-- ALERTA FLUTUANTE -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div id="toast-container">
      {% for message in messages %}
        <div class="toast show">
          <i class="fas fa-check-circle icon"></i>
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- SEÃ‡ÃƒO DE PROMOÃ‡ÃƒO -->
<section class="adm-banner">
    <div class="adm-content">
        <h1 class="mt-3">ðŸ“Š Dashboard de Pedidos</h1>
        <p>Gerencie os pedidos realizados pelos clientes da Radiance</p>
    </div>
</section>

<!-- CONTEÃšDO PRINCIPAL -->
<div class="container-fluid p-4" style="text-align: center;">
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card-stats bg-total">
        <h5>Total de Pedidos</h5>
        <h2>{{ total }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card-stats bg-entregues">
        <h5>Pedidos Entregues</h5>
        <h2>{{ entregues }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card-stats bg-pendentes">
        <h5>Pedidos Pendentes</h5>
        <h2>{{ pendentes }}</h2>
      </div>
    </div>
  </div>

  <!-- TABELA DE PEDIDOS -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3">ðŸ“‹ Lista de Pedidos</h5>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Email</th>
            <th>Telefone</th>
            <th>EndereÃ§o</th>
            <th>Data</th>
            <th>Status de Envio</th>
            <th>AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
          {% for pedido in pedidos %}
          <tr>
            <td>{{ pedido.id }}</td>
            <td>{{ pedido.nome_cliente }}</td>
            <td>{{ pedido.email }}</td>
            <td>{{ pedido.telefone }}</td>
            <td>{{ pedido.endereco }}</td>
            <td>{{ pedido.data_pedido }}</td>
            <td>
              {% if pedido.entregue %}
                <span class="badge bg-success">Entregue</span>
              {% else %}
                <span class="badge bg-warning text-dark">Pendente</span>
              {% endif %}
            </td>
            <td>
              <form method="post"
                    action="{{ url_for('marcar_entregue', pedido_id=pedido.id) }}"
                    style="display:inline;"
                    onsubmit="return confirmarAlteracaoStatus({{ 'true' if pedido.entregue else 'false' }});">
                  <button class="btn btn-sm btn-outline-primary">âœ“</button>
              </form>

              <form method="post"
                    action="{{ url_for('excluir_pedido', pedido_id=pedido.id) }}"
                    style="display:inline;"
                    onsubmit="return confirmarExclusaoComSenha();">
                  <button class="btn btn-sm btn-outline-danger">ðŸ—‘</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- RODAPÃ‰ -->
<footer class="rodape">
    <p>Â© 2025 Radiance. Todos os direitos reservados.</p>
</footer>

<!-- SCRIPTS DE CONFIRMAÃ‡ÃƒO -->
<script>
    function confirmarAlteracaoStatus(entregue) {
        let statusAtual = entregue ? "ENTREGUE" : "PENDENTE";
        let novoStatus = entregue ? "PENDENTE" : "ENTREGUE";

        let confirmar = confirm(`O status atual Ã© "${statusAtual}". Deseja alterar para "${novoStatus}"?`);
        if (!confirmar) return false;

        let senha = prompt("Digite a senha para confirmar a alteraÃ§Ã£o:");
        let senhaCorreta = "1234";

        if (senha === senhaCorreta) {
            return true;
        } else {
            alert("Senha incorreta. AlteraÃ§Ã£o cancelada.");
            return false;
        }
    }

    function confirmarExclusaoComSenha() {
        let confirmar = confirm("Tem certeza que deseja excluir este pedido?");
        if (!confirmar) return false;

        let senha = prompt("Digite a senha para confirmar a exclusÃ£o:");
        let senhaCorreta = "1234";

        if (senha === senhaCorreta) {
            return true;
        } else {
            alert("Senha incorreta. ExclusÃ£o cancelada.");
            return false;
        }
    }
</script>

</body>
</html>
